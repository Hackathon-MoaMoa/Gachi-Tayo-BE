<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.gachitayobe.mapper.PostMapper">

    <sql id="postColumns">
        p_id
        , u_id
		, start_x
        , start_y
		, start_address
		, start_name
        , end_x
        , end_y
		, end_address
		, end_name
        , start_date
        , total_member
        , current_member
        , done
    </sql>

    <insert id="insertPost" parameterType="PostDto">
        INSERT INTO POST (
        <include refid="postColumns" />
        ) VALUES (
        NULL
        , uId
        , startX
        , startY
        , startAddress
        , startName
        , endX
        , endY
        , endAddress
        , endName
        , startDate
        , totalMember
        , currentMember
        , done
        )
    </insert>

    <select id="getPostDetail" parameterType="int" resultType="PostDetailDto">
        SELECT POST.u_id, U.name, U.score, p_id, DATE_FORMAT(start_date, '%Y') as year, DATE_FORMAT(start_date, '%m') as month, DATE_FORMAT(start_date, '%d') as day, DATE_FORMAT(start_date, '%p') as time, DATE_FORMAT(start_date, '%h') as hour, DATE_FORMAT(start_date, '%i') as minute, start_x, start_y, start_name, start_address, end_x, end_y, end_name, end_address, total_member, (total_member-current_member) as remain_member
        FROM POST INNER JOIN USER U on POST.u_id = U.u_id
        WHERE p_id=#{p_id};
    </select>

    <select id="getRemainSeat" parameterType="int" resultType="int">
        SELECT seat_number FROM SEAT_NUMBER WHERE seat_number not in (SELECT seat_number FROM MEMBER WHERE p_id=#{p_id});
    </select>

</mapper>